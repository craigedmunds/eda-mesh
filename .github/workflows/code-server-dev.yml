name: Build and Push Code Server Dev Image

on:
  push:
    branches:
      - main
      # Feature branch builds enabled via .repo-metadata.yaml flag
      - feature/*  # Enable builds from feature branches for infrastructure testing
    paths:
      - 'apps/code-server-dev/**'
      - '.github/workflows/code-server-dev.yml'
      - '.github/workflows/_docker-build.yml'
      - '!apps/code-server-dev/*.md'
      - '!apps/code-server-dev/Taskfile.yaml'

  
  workflow_dispatch:
    inputs:
      version_bump:
        description: 'Version bump type'
        required: false
        default: 'patch'
        type: choice
        options:
          - patch
          - minor
          - major

jobs:
  build-and-push:
    uses: ./.github/workflows/_docker-build.yml
    with:
      app_name: 'Code Server Dev'
      image_name: 'craigedmunds/code-server-dev'
      dockerfile: 'apps/code-server-dev/Dockerfile'
      context: 'apps/code-server-dev'
      version_file: 'apps/code-server-dev/VERSION'
      version_type: 'file'
      # No pre-build script needed for code-server-dev
      # Pass through version_bump input if present
      version_bump: ${{ inputs.version_bump || 'patch' }}
    secrets: inherit