name: Build and Push UV Image

on:
  push:
    branches:
      - main
      # Feature branch builds enabled via .repo-metadata.yaml flag
      - feature/*  # Enable builds from feature branches for infrastructure testing
    paths:
      - 'apps/uv/**'
      - '.github/workflows/uv.yml'
      - '.github/workflows/_docker-build.yml'
      - '!apps/uv/*.md'
      - '!apps/uv/Taskfile.yaml'

  
  workflow_dispatch:
    inputs:
      version_bump:
        description: 'Version bump type'
        required: false
        default: 'patch'
        type: choice
        options:
          - patch
          - minor
          - major

jobs:
  build-and-push:
    uses: ./.github/workflows/_docker-build.yml
    with:
      app_name: 'UV'
      image_name: 'craigedmunds/uv'
      dockerfile: 'apps/uv/Dockerfile'
      context: 'apps/uv'
      version_file: 'apps/uv/VERSION'
      version_type: 'file'
      # No pre-build script needed for UV
      # Pass through version_bump input if present
      version_bump: ${{ inputs.version_bump || 'patch' }}
    secrets: inherit
